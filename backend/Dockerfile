# 1. Базовый образ - Node.js версии 18 на Alpine Linux
# Alpine - минималистичный Linux дистрибутив (очень маленький размер)
FROM node:18-alpine

# 2. Установите рабочую директорию внутри контейнера
# Все последующие команды будут выполняться в этой папке
WORKDIR /app

# 3. Скопируйте файлы зависимостей
# Сначала копируем package.json и package-lock.json
# Это делается отдельно для оптимизации кэширования Docker
COPY package*.json ./

# 4. Установите зависимости
# --only=production устанавливает только production-зависимости
# (без devDependencies)
RUN npm install --only=production

# 5. Скопируйте ВЕСЬ исходный код бэкенда
# Копируем всё из текущей директории в /app контейнера
COPY . .

# 6. Укажите порт, который будет слушать приложение
# Эта команда только информирует Docker о порте
EXPOSE 3001

# 7. Команда для запуска приложения
# Выполняется при запуске контейнера
CMD ["npm", "start"]